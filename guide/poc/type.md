# xray è„šæœ¬æ³¨å…¥çš„ç±»å‹

xray æ”¯æŒæ‰€æœ‰CELæ–‡æ¡£ä¸­çš„ç±»å‹ï¼ŒåŒæ—¶è¿˜æ³¨å…¥äº†å‡ ç§ç‰¹æ®Šçš„ç±»å‹ï¼ŒåŒ…å«ï¼š

- `addrType` è¿æ¥åœ°å€ä¿¡æ¯
- `connInfoType` è¿æ¥ä¿¡æ¯ï¼ŒåŒ…å«æºåœ°å€å’Œç›®çš„åœ°å€, å¯ä»¥é€šè¿‡ `response.conn`
- `urlType` url ç±»å‹ï¼Œå¯ä»¥ `request.url`ã€`response.url` å’Œ `reverse.url` è°ƒç”¨
- `reverseType` åè¿å¹³å°ç±»å‹
- `request` æ‰«æè¯·æ±‚
- `response` è¯·æ±‚çš„å“åº”ï¼Œé€šç”¨å±æ€§åŒ…å«ï¼š`raw`

å…¶ä¸­æ³¨å…¥çš„ request å’Œ response ç±»å‹æ˜¯éšç€ `transport` å¯¹åº”çš„å€¼è¿›è¡Œæ”¹å˜çš„ã€‚

## åŸºæœ¬ç±»å‹

### addrType

addrType ç±»å‹åŒ…å«å­—æ®µå¦‚ä¸‹, è®¾å˜é‡åä¸º `addr`

| å˜é‡å              | ç±»å‹       | è¯´æ˜                                                        | é€‚ç”¨ç‰ˆæœ¬         |
|------------------|----------|-----------------------------------------------------------|--------------|
| `addr.transport` | `string` | tranport                                                  | xray â‰¥ 1.8.4 |
| `addr.addr`      | `string` | ç›®çš„åœ°å€ï¼Œ è·å–å¤±è´¥æ—¶è¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œå½¢å¦‚ï¼š `192.0.2.1:25`, `[2001:2001::1]:80` | xray â‰¥ 1.8.4 |
| `addr.port`      | `string` | ç«¯å£å·ï¼Œ è·å–å¤±è´¥æ—¶è¿”å› `""`                                         | xray â‰¥ 1.8.4 |

### connInfoType

connInfoType ç±»å‹åŒ…å«å­—æ®µå¦‚ä¸‹, è®¾å˜é‡åä¸º `conn`

| å˜é‡å                | ç±»å‹         | è¯´æ˜     | é€‚ç”¨ç‰ˆæœ¬         |
|--------------------|------------|--------|--------------|
| `conn.source`      | `addrType` | æºåœ°å€ä¿¡æ¯  | xray â‰¥ 1.8.4 |
| `conn.destination` | `addrType` | ç›®çš„åœ°å€ä¿¡æ¯ | xray â‰¥ 1.8.4 |

### urlType

urlType ç±»å‹åŒ…å«çš„å­—æ®µå¦‚ä¸‹, è®¾å˜é‡åä¸º `url`, ä»¥ `http://example.com:8080/a?c=d#x=y` ä¸ºä¾‹:

| å˜é‡å            | ç±»å‹       | è¯´æ˜                                 | é€‚ç”¨ç‰ˆæœ¬         |
|----------------|----------|------------------------------------|--------------|
| `url.scheme`   | `string` | url çš„ scheme, ç¤ºä¾‹ä¸º `"http"`         | xray â‰¥ 1.8.4 |
| `url.domain`   | `string` | url çš„åŸŸåï¼Œç¤ºä¾‹ä¾‹ä¸º `"example.com"`       | xray â‰¥ 1.8.4 |
| `url.host`     | `string` | url çš„ä¸»æœºåï¼Œç¤ºä¾‹ä¸º `"example.com:8080"`  | xray â‰¥ 1.8.4 |
| `url.port`     | `string` | url çš„ portï¼Œæ³¨æ„è¿™é‡Œä¹Ÿæ˜¯å­—ç¬¦ä¸²ã€‚ ç¤ºä¾‹ä¸º `"8080"` | xray â‰¥ 1.8.4 |
| `url.path`     | `string` | url çš„ pathï¼Œ ç¤ºä¾‹ä¸º `"/a"`             | xray â‰¥ 1.8.4 |
| `url.query`    | `string` | url çš„ query, ç¤ºä¾‹ä¸º `"c=d"`           | xray â‰¥ 1.8.4 |
| `url.fragment` | `string` | url çš„é”šç‚¹ï¼Œç¤ºä¾‹ä¸º `"x=y"`                | xray â‰¥ 1.8.4 |

### reverseType

reverseType ç±»å‹åŒ…å«å­—æ®µå¦‚ä¸‹, è®¾å˜é‡åä¸º `reverse`ï¼ˆéœ€è¦å…ˆä½¿ç”¨ `newReverse()` ç”Ÿæˆå®ä¾‹)

| å˜é‡å                             | ç±»å‹                        | è¯´æ˜                            | é€‚ç”¨ç‰ˆæœ¬         |
|---------------------------------|---------------------------|-------------------------------|--------------|
| `reverse.url`                   | `urlType`                 | åè¿å¹³å°çš„ url                     | xray â‰¥ 1.8.4 |
| `reverse.domain`                | `string`                  | åè¿å¹³å°çš„åŸŸå                       | xray â‰¥ 1.8.4 |
| `reverse.rmi`                   | `urlType`                 | åè¿å¹³å°çš„rmiåè®®url                 | xray â‰¥ 1.9.4 |
| `reverse.ip`                    | `string`                  | åè¿å¹³å°çš„ ip åœ°å€                   | xray â‰¥ 1.8.4 |
| `reverse.is_domain_name_server` | `bool`                    | åè¿å¹³å°çš„ domain æ˜¯å¦åŒæ—¶æ˜¯ nameserver | xray â‰¥ 1.8.4 |
| `reverse.wait(timeout)`         | `func (timeout int) bool` | ç­‰å¾… timeout ç§’ï¼Œå¹¶è¿”å›æ˜¯å¦åœ¨æ”¹æ—¶é—´å†…è·å¾—äº†ä¿¡æ¯  | xray â‰¥ 1.8.4 |

> å‚æ•°è¯¦æƒ…ä»‹ç»ï¼š[ğŸ”è¯¦æƒ…](guide/poc/exampleType/reverse.md)

### Timestamp

Timestamp ç±»å‹å®é™…æ˜¯google.protobuf.Timestampç±»å‹ï¼Œä¸ºcelè¡¨è¾¾å¼æœ¬èº«è‡ªå¸¦çš„ç±»å‹ï¼Œå…¶æœ¬èº«åŒ…å«äº†éå¸¸å¤šçš„æ–¹æ³•ï¼Œè¯¦æƒ…å¯æŸ¥çœ‹ï¼š[Timestamp](guide/poc/exampleType/timestamp.md)

## tcp request and response

å…¶ä¸­ request åŒ…å«çš„å­—æ®µå¦‚ä¸‹ï¼š

| å˜é‡å           | ç±»å‹       | è¯´æ˜   | é€‚ç”¨ç‰ˆæœ¬         |
|---------------|----------|------|--------------|
| `request.raw` | `[]byte` | åŸå§‹è¯·æ±‚ | xray â‰¥ 1.8.4 |

response åŒ…å«çš„å­—æ®µå¦‚ä¸‹:

| å˜é‡å             | ç±»å‹             | è¯´æ˜     | é€‚ç”¨ç‰ˆæœ¬         |
|-----------------|----------------|--------|--------------|
| `response.conn` | `connInfoType` | è¿æ¥ç›¸å…³ä¿¡æ¯ | xray â‰¥ 1.8.4 |
| `response.raw`  | `[]byte`       | åŸå§‹å“åº”   | xray â‰¥ 1.8.4 |

## udp request and response

å…¶ä¸­ request åŒ…å«çš„å­—æ®µå¦‚ä¸‹ï¼š

| å˜é‡å           | ç±»å‹       | è¯´æ˜   | é€‚ç”¨ç‰ˆæœ¬         |
|---------------|----------|------|--------------|
| `request.raw` | `[]byte` | åŸå§‹è¯·æ±‚ | xray â‰¥ 1.8.4 |

response åŒ…å«çš„å­—æ®µå¦‚ä¸‹:

| å˜é‡å             | ç±»å‹             | è¯´æ˜     | é€‚ç”¨ç‰ˆæœ¬         |
|-----------------|----------------|--------|--------------|
| `response.conn` | `connInfoType` | è¿æ¥ç›¸å…³ä¿¡æ¯ | xray â‰¥ 1.8.4 |
| `response.raw`  | `[]byte`       | åŸå§‹å“åº”   | xray â‰¥ 1.8.4 |

## http request and response

å…¶ä¸­ request åŒ…å«çš„å­—æ®µå¦‚ä¸‹ï¼š

| å˜é‡å                    | ç±»å‹                  | è¯´æ˜                                                                                                                                      | é€‚ç”¨ç‰ˆæœ¬         |
|------------------------|---------------------|-----------------------------------------------------------------------------------------------------------------------------------------|--------------|
| `request.raw`          | `[]byte`            | åŸå§‹è¯·æ±‚                                                                                                                                    | xray â‰¥ 1.8.4 |
| `request.url`          | `urlType`           | è‡ªå®šä¹‰ç±»å‹ urlType, è¯·æŸ¥çœ‹ä¸‹æ–¹ urlType çš„è¯´æ˜                                                                                                        | xray â‰¥ 1.8.4 |
| `request.method`       | `string`            | åŸå§‹è¯·æ±‚çš„æ–¹æ³•                                                                                                                                 | xray â‰¥ 1.8.4 |
| `request.headers`      | `map[string]string` | åŸå§‹è¯·æ±‚çš„HTTPå¤´ï¼Œæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆå‡ä¸ºå°å†™ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`headers['server']`æ¥è·å–å€¼ã€‚å¦‚æœé”®ä¸å­˜åœ¨ï¼Œåˆ™è·å–åˆ°çš„å€¼æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚æ³¨æ„ï¼Œè¯¥ç©ºå­—ç¬¦ä¸²ä¸èƒ½ç”¨äº `==` ä»¥å¤–çš„æ“ä½œï¼Œå¦åˆ™ä¸å­˜åœ¨çš„æ—¶å€™å°†æŠ¥é”™ï¼Œéœ€è¦å…ˆ `in` åˆ¤æ–­ä¸‹ã€‚è¯¦æƒ…å‚è€ƒä¸‹æ–‡å¸¸ç”¨å‡½æ•°ç« èŠ‚ã€‚ | xray â‰¥ 1.8.4 |
| `request.content_type` | `string`            | åŸå§‹è¯·æ±‚çš„ content-type å¤´çš„å€¼, ç­‰äº`request.headers["Content-Type"]`                                                                             | xray â‰¥ 1.8.4 |
| `request.raw_header`   | `[]byte`            | åŸå§‹çš„ header éƒ¨åˆ†ï¼Œéœ€è¦ä½¿ç”¨å­—èŠ‚æµç›¸å…³æ–¹æ³•æ¥åˆ¤æ–­ã€‚                                                                                                           | xray â‰¥ 1.8.4 |
| `request.body`         | `[]byte`            | åŸå§‹è¯·æ±‚çš„ bodyï¼Œéœ€è¦ä½¿ç”¨å­—èŠ‚æµç›¸å…³æ–¹æ³•æ¥åˆ¤æ–­ã€‚å¦‚æœæ˜¯ GETï¼Œ body ä¸ºç©ºã€‚                                                                                             | xray â‰¥ 1.8.4 |

response åŒ…å«çš„å­—æ®µå¦‚ä¸‹:

| å˜é‡å                     | ç±»å‹                  | è¯´æ˜                                                 | é€‚ç”¨ç‰ˆæœ¬         |
|-------------------------|---------------------|----------------------------------------------------|--------------|
| `response.raw`          | `[]byte`            | åŸå§‹å“åº”                                               | xray â‰¥ 1.8.4 |
| `response.url`          | `urlType`           | è‡ªå®šä¹‰ç±»å‹ urlType, è¯·æŸ¥çœ‹ä¸‹æ–¹ urlType çš„è¯´æ˜                   | xray â‰¥ 1.8.4 |
| `response.status`       | `int`               | è¿”å›åŒ…çš„status code                                    | xray â‰¥ 1.8.4 |
| `response.raw_header`   | `[]byte`            | åŸå§‹çš„ header éƒ¨åˆ†ï¼Œéœ€è¦ä½¿ç”¨å­—èŠ‚æµç›¸å…³æ–¹æ³•æ¥åˆ¤æ–­ã€‚                      | xray â‰¥ 1.8.4 |
| `response.body`         | `[]byte`            | è¿”å›åŒ…çš„Bodyï¼Œå› ä¸ºæ˜¯ä¸€ä¸ªå­—èŠ‚æµï¼ˆbytesï¼‰è€Œéå­—ç¬¦ä¸²ï¼Œåé¢åˆ¤æ–­çš„æ—¶å€™éœ€è¦ä½¿ç”¨å­—èŠ‚æµç›¸å…³çš„æ–¹æ³•  | xray â‰¥ 1.8.4 |
| `response.body_string`  | `string`            | è¿”å›åŒ…çš„Bodyï¼Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²                                    | xray â‰¥ 1.9.1 |
| `response.headers`      | `map[string]string` | è¿”å›åŒ…çš„HTTPå¤´ï¼Œç±»ä¼¼ `request.headers`ã€‚                    | xray â‰¥ 1.8.4 |
| `response.content_type` | `string`            | è¿”å›åŒ…çš„content-typeå¤´çš„å€¼                                | xray â‰¥ 1.8.4 |
| `response.latency`      | `int`               | å“åº”çš„å»¶è¿Ÿæ—¶é—´ï¼Œå¯ä»¥ç”¨äº sql æ—¶é—´ç›²æ³¨çš„åˆ¤æ–­ï¼Œå•ä½æ¯«ç§’ (ms)                 | xray â‰¥ 1.8.4 |
| `response.title`        | `[]byte`            | è¿”å›åŒ…çš„Titleï¼Œå› ä¸ºæ˜¯ä¸€ä¸ªå­—èŠ‚æµï¼ˆbytesï¼‰è€Œéå­—ç¬¦ä¸²ï¼Œåé¢åˆ¤æ–­çš„æ—¶å€™éœ€è¦ä½¿ç”¨å­—èŠ‚æµç›¸å…³çš„æ–¹æ³• | xray â‰¥ 1.8.5 |
| `response.title_string` | `string`            | è¿”å›åŒ…çš„Titleï¼Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²                                   | xray â‰¥ 1.8.5 |
